<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù¾ÙˆÙ„â€ŒÛŒØ§Ø± â€” Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§Ù„ÛŒ Ø´Ø®ØµÛŒ</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: rgba(245, 245, 250, 0.85);
    --bg-solid: #f0f0f5;
    --glass: rgba(255, 255, 255, 0.55);
    --glass2: rgba(255, 255, 255, 0.35);
    --glass-border: rgba(255, 255, 255, 0.6);
    --glass-shadow: rgba(0, 0, 0, 0.06);
    --accent: #6c5ce7;
    --accent2: #a29bfe;
    --accent-glass: rgba(108, 92, 231, 0.12);
    --green: #00b894;
    --green-bg: rgba(0, 184, 148, 0.1);
    --red: #e55039;
    --red-bg: rgba(229, 80, 57, 0.1);
    --yellow: #f9ca24;
    --text: #1a1a2e;
    --text2: #6b7280;
    --text3: #9ca3af;
    --border: rgba(0, 0, 0, 0.08);
    --radius: 16px;
    --sidebar-w: 220px;
    --blur: 20px;
  }

  [data-theme="dark"] {
    --bg: rgba(15, 15, 22, 0.9);
    --bg-solid: #0f0f16;
    --glass: rgba(30, 30, 45, 0.6);
    --glass2: rgba(40, 40, 60, 0.4);
    --glass-border: rgba(255, 255, 255, 0.08);
    --glass-shadow: rgba(0, 0, 0, 0.3);
    --accent: #7c6cf0;
    --accent2: #a29bfe;
    --accent-glass: rgba(124, 108, 240, 0.15);
    --green: #00cec9;
    --green-bg: rgba(0, 206, 201, 0.12);
    --red: #ff6b6b;
    --red-bg: rgba(255, 107, 107, 0.12);
    --text: #e8e8f0;
    --text2: #8888a0;
    --text3: #555568;
    --border: rgba(255, 255, 255, 0.06);
  }

  body {
    font-family: 'Vazirmatn', Tahoma, sans-serif;
    background: var(--bg-solid);
    color: var(--text);
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    overflow: hidden;
    transition: background 0.3s;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: 
      radial-gradient(ellipse at 20% 20%, rgba(108,92,231,0.15) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 80%, rgba(0,184,148,0.1) 0%, transparent 50%),
      radial-gradient(ellipse at 50% 50%, rgba(249,202,36,0.05) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  [data-theme="dark"] body::before {
    background: 
      radial-gradient(ellipse at 20% 20%, rgba(108,92,231,0.12) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 80%, rgba(0,206,201,0.08) 0%, transparent 50%);
  }

  .window-frame {
    position: relative;
    z-index: 1;
    width: 1100px;
    height: 650px;
    max-width: 96vw;
    max-height: 90vh;
    background: var(--bg);
    backdrop-filter: blur(var(--blur));
    -webkit-backdrop-filter: blur(var(--blur));
    border-radius: 20px;
    border: 1px solid var(--glass-border);
    box-shadow: 
      0 20px 60px var(--glass-shadow),
      0 0 0 1px var(--glass-border) inset;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .titlebar {
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    background: var(--glass2);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    -webkit-app-region: drag;
    user-select: none;
  }

  .titlebar-dots {
    display: flex;
    gap: 7px;
    -webkit-app-region: no-drag;
  }

  .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    cursor: pointer;
    transition: opacity 0.15s;
    border: none;
    padding: 0;
  }

  .dot:hover { opacity: 0.8; }
  .dot.close { background: #ff5f57; }
  .dot.minimize { background: #ffbd2e; }
  .dot.maximize { background: #28c840; }

  .titlebar-title {
    font-size: 12px;
    font-weight: 500;
    color: var(--text2);
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }

  .titlebar-actions {
    display: flex;
    gap: 8px;
    -webkit-app-region: no-drag;
  }

  .theme-toggle {
    background: none;
    border: none;
    font-size: 16px;
    cursor: pointer;
    padding: 2px;
    border-radius: 6px;
    transition: background 0.2s;
    line-height: 1;
  }

  .theme-toggle:hover { background: var(--glass); }

  .app-body {
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  .sidebar {
    width: var(--sidebar-w);
    background: var(--glass2);
    backdrop-filter: blur(10px);
    border-left: 1px solid var(--border);
    padding: 16px 10px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex-shrink: 0;
    overflow-y: auto;
  }

  .sidebar::-webkit-scrollbar { width: 0; }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    margin-bottom: 16px;
  }

  .logo-icon {
    font-size: 22px;
    width: 38px;
    height: 38px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(108,92,231,0.3);
  }

  .logo-text { font-size: 15px; font-weight: 700; }
  .logo-sub { font-size: 10px; color: var(--text2); font-weight: 400; }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 12px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 13px;
    color: var(--text2);
    border: none;
    background: none;
    width: 100%;
    text-align: right;
    font-family: inherit;
  }

  .nav-item:hover { background: var(--glass); color: var(--text); }
  .nav-item.active {
    background: var(--accent);
    color: #fff;
    box-shadow: 0 4px 12px rgba(108,92,231,0.25);
  }
  .nav-item .icon { font-size: 17px; width: 22px; text-align: center; }

  .nav-section {
    font-size: 10px;
    color: var(--text3);
    padding: 12px 12px 4px;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  .sidebar-footer {
    margin-top: auto;
    padding: 12px;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--green));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
  }

  .main {
    flex: 1;
    padding: 20px 24px;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .main::-webkit-scrollbar { width: 5px; }
  .main::-webkit-scrollbar-track { background: transparent; }
  .main::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .header h1 { font-size: 19px; font-weight: 700; }
  .header-date { color: var(--text2); font-size: 11px; margin-top: 2px; }

  .header-actions { display: flex; gap: 8px; }

  .btn {
    padding: 7px 14px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-family: inherit;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .btn-primary {
    background: var(--accent);
    color: #fff;
    box-shadow: 0 2px 8px rgba(108,92,231,0.2);
  }
  .btn-primary:hover { background: var(--accent2); }

  .btn-outline {
    background: var(--glass);
    color: var(--text);
    border: 1px solid var(--border);
    backdrop-filter: blur(10px);
  }
  .btn-outline:hover { background: var(--glass2); }
  .btn-outline.active { background: var(--accent-glass); border-color: var(--accent); color: var(--accent); }

  .btn-green { background: var(--green); color: #fff; }
  .btn-red { background: var(--red); color: #fff; }
  .btn-sm { padding: 5px 10px; font-size: 11px; border-radius: 8px; }

  .stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }

  .stat-card {
    background: var(--glass);
    backdrop-filter: blur(10px);
    border-radius: 14px;
    padding: 16px;
    border: 1px solid var(--glass-border);
    transition: transform 0.2s;
  }

  .stat-card:hover { transform: translateY(-2px); }

  .stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .stat-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
  }

  .stat-icon.income { background: var(--green-bg); }
  .stat-icon.expense { background: var(--red-bg); }
  .stat-icon.balance { background: var(--accent-glass); }
  .stat-icon.savings { background: rgba(249,202,36,0.12); }

  .stat-label { font-size: 11px; color: var(--text2); }
  .stat-value { font-size: 20px; font-weight: 700; margin: 2px 0; direction: ltr; text-align: right; }
  .stat-change { font-size: 10px; display: flex; align-items: center; gap: 3px; }
  .stat-change.up { color: var(--green); }
  .stat-change.down { color: var(--red); }

  .charts-grid {
    display: grid;
    grid-template-columns: 5fr 3fr;
    gap: 12px;
    margin-bottom: 20px;
  }

  .card {
    background: var(--glass);
    backdrop-filter: blur(10px);
    border-radius: 14px;
    padding: 18px;
    border: 1px solid var(--glass-border);
  }

  .card-title {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 14px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .chart-tabs {
    display: flex;
    gap: 3px;
    background: var(--glass2);
    border-radius: 7px;
    padding: 2px;
  }

  .chart-tab {
    padding: 4px 10px;
    border-radius: 5px;
    border: none;
    background: none;
    color: var(--text2);
    font-size: 10px;
    cursor: pointer;
    font-family: inherit;
    transition: all 0.2s;
  }
  .chart-tab.active { background: var(--accent); color: #fff; }

  .bar-chart {
    display: flex;
    align-items: flex-end;
    gap: 6px;
    height: 150px;
    padding-top: 10px;
  }

  .bar-group {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    height: 100%;
    justify-content: flex-end;
  }

  .bar-pair {
    display: flex;
    gap: 2px;
    align-items: flex-end;
    width: 100%;
    justify-content: center;
    flex: 1;
  }

  .bar {
    width: 12px;
    border-radius: 4px 4px 0 0;
    transition: height 0.6s cubic-bezier(0.4,0,0.2,1);
    cursor: pointer;
  }

  .bar:hover { opacity: 0.75; filter: brightness(1.1); }
  .bar.income-bar { background: linear-gradient(180deg, var(--green), rgba(0,184,148,0.5)); }
  .bar.expense-bar { background: linear-gradient(180deg, var(--red), rgba(229,80,57,0.4)); }

  .bar-label { font-size: 9px; color: var(--text3); white-space: nowrap; }

  .donut-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
  }

  .donut-center {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .donut-total {
    position: absolute;
    text-align: center;
  }

  .donut-total-label { font-size: 9px; color: var(--text3); }
  .donut-total-value { font-size: 14px; font-weight: 700; }

  .donut-legend { display: flex; flex-direction: column; gap: 6px; width: 100%; }

  .legend-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 11px;
  }

  .legend-right { display: flex; align-items: center; gap: 6px; }
  .legend-color { width: 8px; height: 8px; border-radius: 50%; }

  .bottom-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 20px;
  }

  .tx-list {
    display: flex;
    flex-direction: column;
    gap: 2px;
    max-height: 220px;
    overflow-y: auto;
  }

  .tx-list::-webkit-scrollbar { width: 3px; }
  .tx-list::-webkit-scrollbar-track { background: transparent; }
  .tx-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  .tx-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 10px;
    border-radius: 10px;
    transition: background 0.15s;
    cursor: pointer;
  }

  .tx-item:hover { background: var(--glass2); }

  .tx-right { display: flex; align-items: center; gap: 10px; }

  .tx-icon {
    width: 34px;
    height: 34px;
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px;
    background: var(--glass2);
  }

  .tx-name { font-size: 12px; font-weight: 500; }
  .tx-cat { font-size: 10px; color: var(--text2); }
  .tx-amount { font-size: 12px; font-weight: 600; direction: ltr; }
  .tx-amount.income { color: var(--green); }
  .tx-amount.expense { color: var(--red); }

  .tx-delete {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.15s;
    padding: 4px;
    border-radius: 6px;
  }

  .tx-item:hover .tx-delete { opacity: 0.6; }
  .tx-delete:hover { opacity: 1 !important; background: var(--red-bg); }

  .area-chart-svg { width: 100%; height: 160px; }

  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }

  .modal-overlay.active { opacity: 1; pointer-events: all; }

  .modal {
    background: var(--glass);
    backdrop-filter: blur(30px);
    border-radius: 18px;
    padding: 24px;
    width: 380px;
    max-width: 90vw;
    border: 1px solid var(--glass-border);
    transform: translateY(20px) scale(0.97);
    transition: transform 0.25s;
    box-shadow: 0 20px 40px var(--glass-shadow);
  }

  .modal-overlay.active .modal { transform: translateY(0) scale(1); }

  .modal h2 {
    font-size: 16px;
    margin-bottom: 18px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .form-group { margin-bottom: 12px; }

  .form-group label {
    display: block;
    font-size: 11px;
    color: var(--text2);
    margin-bottom: 4px;
  }

  .form-group input, .form-group select {
    width: 100%;
    padding: 8px 12px;
    background: var(--glass2);
    border: 1px solid var(--border);
    border-radius: 9px;
    color: var(--text);
    font-family: inherit;
    font-size: 13px;
    outline: none;
    transition: border 0.2s;
    backdrop-filter: blur(5px);
  }

  .form-group input:focus, .form-group select:focus { border-color: var(--accent); }

  .form-row { display: flex; gap: 10px; }
  .form-row .form-group { flex: 1; }

  .modal-actions { display: flex; gap: 8px; margin-top: 18px; }
  .modal-actions .btn { flex: 1; justify-content: center; padding: 10px; }

  .type-toggle {
    display: flex;
    background: var(--glass2);
    border-radius: 9px;
    padding: 3px;
    gap: 3px;
  }

  .type-btn {
    flex: 1;
    padding: 8px;
    border: none;
    border-radius: 7px;
    font-family: inherit;
    font-size: 12px;
    cursor: pointer;
    background: transparent;
    color: var(--text2);
    transition: all 0.2s;
  }

  .type-btn.active.income-type { background: var(--green); color: #fff; }
  .type-btn.active.expense-type { background: var(--red); color: #fff; }

  .mini-chart {
    display: flex;
    align-items: flex-end;
    gap: 2px;
    height: 28px;
    margin-top: 8px;
  }

  .mini-bar {
    flex: 1;
    border-radius: 2px;
    opacity: 0.4;
    transition: all 0.3s;
  }
  .mini-bar:last-child { opacity: 1; }

  .progress-ring { position: relative; display: flex; align-items: center; justify-content: center; }
  .progress-text { position: absolute; font-size: 16px; font-weight: 700; }

  .heatmap { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; }
  .heat-cell {
    aspect-ratio: 1;
    border-radius: 3px;
    background: var(--glass2);
    cursor: pointer;
    transition: all 0.15s;
  }
  .heat-cell:hover { transform: scale(1.3); }

  .notification {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    padding: 10px 18px;
    font-size: 12px;
    z-index: 200;
    display: flex;
    align-items: center;
    gap: 6px;
    opacity: 0;
    transition: all 0.3s;
    box-shadow: 0 8px 24px var(--glass-shadow);
  }
  .notification.show { transform: translateX(-50%) translateY(0); opacity: 1; }

  .page { display: none; }
  .page.active { display: block; animation: fadeIn 0.25s ease; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  select option { background: var(--bg-solid); }

  .empty-state {
    text-align: center;
    padding: 30px;
    color: var(--text2);
    font-size: 12px;
  }

  .chart-legend {
    display: flex;
    gap: 14px;
    margin-top: 8px;
    justify-content: center;
  }

  .chart-legend span {
    font-size: 10px;
    color: var(--text2);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .chart-legend-dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    display: inline-block;
  }

  .search-box {
    padding: 7px 12px;
    background: var(--glass2);
    border: 1px solid var(--border);
    border-radius: 9px;
    color: var(--text);
    font-family: inherit;
    font-size: 12px;
    outline: none;
    width: 180px;
    transition: border 0.2s;
  }
  .search-box:focus { border-color: var(--accent); }
  .search-box::placeholder { color: var(--text3); }

  /* Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ */
  .category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 10px;
    margin-bottom: 16px;
  }

  .category-card {
    background: var(--glass2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }

  .category-card:hover { background: var(--glass); transform: translateY(-2px); }

  .category-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 6px;
  }

  .category-card-icon {
    font-size: 24px;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--glass);
  }

  .category-card-name {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 2px;
  }

  .category-card-type {
    font-size: 10px;
    color: var(--text3);
  }

  .category-delete {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 14px;
    padding: 4px;
    opacity: 0;
    transition: opacity 0.2s;
    border-radius: 6px;
  }

  .category-card:hover .category-delete { opacity: 0.5; }
  .category-delete:hover { opacity: 1 !important; background: var(--red-bg); }

  .emoji-picker {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 4px;
    max-height: 200px;
    overflow-y: auto;
    padding: 8px;
    background: var(--glass2);
    border-radius: 10px;
    margin-bottom: 12px;
  }

  .emoji-item {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: none;
    background: var(--glass);
    font-size: 20px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .emoji-item:hover {
    background: var(--accent-glass);
    transform: scale(1.1);
  }

  .color-picker {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 6px;
    margin-top: 8px;
  }

  .color-item {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    border: 2px solid transparent;
    cursor: pointer;
    transition: all 0.2s;
  }

  .color-item:hover { transform: scale(1.1); }
  .color-item.active { border-color: var(--text); box-shadow: 0 0 0 2px var(--glass); }

  @media (max-width: 900px) {
    .window-frame { width: 100vw; height: 100vh; max-width: 100vw; max-height: 100vh; border-radius: 0; }
    .stats { grid-template-columns: repeat(2, 1fr); }
    .charts-grid { grid-template-columns: 1fr; }
    .bottom-grid { grid-template-columns: 1fr; }
    .sidebar { display: none; }
  }
</style>
</head>
<body>

<div class="window-frame">
  <div class="titlebar">
    <div class="titlebar-dots">
      <button class="dot close" onclick="window.electronAPI?.closeWindow()" title="Ø¨Ø³ØªÙ†"></button>
      <button class="dot minimize" onclick="window.electronAPI?.minimizeWindow()" title="Ú©ÙˆÚ†Ú©"></button>
      <button class="dot maximize" onclick="window.electronAPI?.maximizeWindow()" title="Ø¨Ø²Ø±Ú¯"></button>
    </div>
    <div class="titlebar-title">ğŸ’° Ù¾ÙˆÙ„â€ŒÛŒØ§Ø± v1.0</div>
    <div class="titlebar-actions">
      <button class="theme-toggle" id="themeToggle" title="ØªØºÛŒÛŒØ± ØªÙ…">ğŸŒ™</button>
    </div>
  </div>

  <div class="app-body">
    <aside class="sidebar" id="sidebar">
      <div class="logo">
        <div class="logo-icon">ğŸ’°</div>
        <div>
          <div class="logo-text">Ù¾ÙˆÙ„â€ŒÛŒØ§Ø±</div>
          <div class="logo-sub">Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§Ù„ÛŒ Ø´Ø®ØµÛŒ</div>
        </div>
      </div>

      <div class="nav-section">Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ</div>
      <button class="nav-item active" onclick="switchPage('dashboard',this)">
        <span class="icon">ğŸ“Š</span> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
      </button>
      <button class="nav-item" onclick="switchPage('transactions',this)">
        <span class="icon">ğŸ“‹</span> ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
      </button>
      <button class="nav-item" onclick="switchPage('analytics',this)">
        <span class="icon">ğŸ“ˆ</span> ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§
      </button>
      <button class="nav-item" onclick="switchPage('budgets',this)">
        <span class="icon">ğŸ¯</span> Ø¨ÙˆØ¯Ø¬Ù‡â€ŒØ¨Ù†Ø¯ÛŒ
      </button>
      <button class="nav-item" onclick="switchPage('categories',this)">
        <span class="icon">ğŸ·ï¸</span> Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
      </button>

      <div class="nav-section">Ø³ÛŒØ³ØªÙ…</div>
      <button class="nav-item" onclick="switchPage('settings',this)">
        <span class="icon">âš™ï¸</span> ØªÙ†Ø¸ÛŒÙ…Ø§Øª
      </button>

      <div class="sidebar-footer">
        <div class="avatar">ğŸ‘¤</div>
        <div>
          <div style="font-size:11px;font-weight:600;">Ú©Ø§Ø±Ø¨Ø± Ù¾ÙˆÙ„â€ŒÛŒØ§Ø±</div>
          <div style="font-size:9px;color:var(--text3);">Ù†Ø³Ø®Ù‡ Ø§ÙÙ„Ø§ÛŒÙ†</div>
        </div>
      </div>
    </aside>

    <main class="main">

      <!-- ========== DASHBOARD ========== -->
      <div class="page active" id="page-dashboard">
        <div class="header">
          <div>
            <h1>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</h1>
            <div class="header-date" id="currentDate"></div>
          </div>
          <div class="header-actions">
            <button class="btn btn-outline" onclick="openModal('expense')">â– Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡</button>
            <button class="btn btn-primary" onclick="openModal('income')">â• Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯</button>
          </div>
        </div>

        <div class="stats" id="statsCards"></div>

        <div class="charts-grid">
          <div class="card">
            <div class="card-title">
              <span>Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡</span>
              <div class="chart-tabs">
                <button class="chart-tab active" onclick="setBarView('monthly',this)">Ù…Ø§Ù‡Ø§Ù†Ù‡</button>
                <button class="chart-tab" onclick="setBarView('weekly',this)">Ù‡ÙØªÚ¯ÛŒ</button>
              </div>
            </div>
            <div class="bar-chart" id="barChart"></div>
            <div class="chart-legend">
              <span><span class="chart-legend-dot" style="background:var(--green)"></span> Ø¯Ø±Ø¢Ù…Ø¯</span>
              <span><span class="chart-legend-dot" style="background:var(--red)"></span> Ù‡Ø²ÛŒÙ†Ù‡</span>
            </div>
          </div>

          <div class="card">
            <div class="card-title">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</div>
            <div class="donut-container" id="donutChart"></div>
          </div>
        </div>

        <div class="bottom-grid">
          <div class="card">
            <div class="card-title">Ø¢Ø®Ø±ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</div>
            <div class="tx-list" id="recentTx"></div>
          </div>
          <div class="card">
            <div class="card-title">Ø±ÙˆÙ†Ø¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</div>
            <svg class="area-chart-svg" id="areaChart"></svg>
          </div>
        </div>
      </div>

      <!-- ========== TRANSACTIONS ========== -->
      <div class="page" id="page-transactions">
        <div class="header">
          <div>
            <h1>ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h1>
            <div class="header-date">Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø¬Ø³Øªâ€ŒÙˆØ¬Ùˆ</div>
          </div>
          <div class="header-actions">
            <input class="search-box" type="text" id="txSearch" placeholder="ğŸ” Ø¬Ø³Øªâ€ŒÙˆØ¬Ùˆ..." oninput="renderAllTx()">
            <button class="btn btn-primary" onclick="openModal('income')">â• Ø¬Ø¯ÛŒØ¯</button>
          </div>
        </div>
        <div class="card">
          <div style="display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap;">
            <button class="btn btn-outline btn-sm filter-btn active" onclick="filterTx('all',this)">Ù‡Ù…Ù‡</button>
            <button class="btn btn-outline btn-sm filter-btn" onclick="filterTx('income',this)">ğŸ’µ Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§</button>
            <button class="btn btn-outline btn-sm filter-btn" onclick="filterTx('expense',this)">ğŸ”» Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</button>
          </div>
          <div class="tx-list" id="allTx" style="max-height:400px;"></div>
        </div>
      </div>

      <!-- ========== ANALYTICS ========== -->
      <div class="page" id="page-analytics">
        <div class="header">
          <div>
            <h1>ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§</h1>
            <div class="header-date">Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø§Ù„ÛŒ</div>
          </div>
        </div>

        <div class="charts-grid" style="grid-template-columns:1fr 1fr;">
          <div class="card">
            <div class="card-title">Ù†Ù‚Ø´Ù‡ Ø­Ø±Ø§Ø±ØªÛŒ Ù‡Ø²ÛŒÙ†Ù‡ (Û³Û° Ø±ÙˆØ²)</div>
            <div class="heatmap" id="heatmap"></div>
            <div style="display:flex;justify-content:space-between;margin-top:6px;">
              <span style="font-size:9px;color:var(--text3);">Ú©Ù…</span>
              <div style="display:flex;gap:2px;">
                <span style="width:10px;height:10px;border-radius:2px;background:var(--glass2);"></span>
                <span style="width:10px;height:10px;border-radius:2px;background:rgba(229,80,57,0.2);"></span>
                <span style="width:10px;height:10px;border-radius:2px;background:rgba(229,80,57,0.5);"></span>
                <span style="width:10px;height:10px;border-radius:2px;background:rgba(229,80,57,0.8);"></span>
                <span style="width:10px;height:10px;border-radius:2px;background:var(--red);"></span>
              </div>
              <span style="font-size:9px;color:var(--text3);">Ø²ÛŒØ§Ø¯</span>
            </div>
          </div>

          <div class="card">
            <div class="card-title">Ù†Ø³Ø¨Øª Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø²</div>
            <div style="display:flex;align-items:center;justify-content:center;gap:24px;padding:10px 0;">
              <div class="progress-ring">
                <svg width="110" height="110" viewBox="0 0 110 110">
                  <circle cx="55" cy="55" r="45" stroke="var(--glass2)" stroke-width="9" fill="none"/>
                  <circle cx="55" cy="55" r="45" stroke="var(--green)" stroke-width="9" fill="none"
                    stroke-dasharray="283" id="savingsRing"
                    stroke-linecap="round" transform="rotate(-90 55 55)" style="transition:stroke-dashoffset 0.8s;"/>
                </svg>
                <div class="progress-text" id="savingsPercent">0%</div>
              </div>
              <div style="font-size:12px;">
                <div style="color:var(--text2);margin-bottom:4px;">Ø¯Ø±Ø¢Ù…Ø¯</div>
                <div style="font-weight:600;margin-bottom:10px;" id="anIncome">0</div>
                <div style="color:var(--text2);margin-bottom:4px;">Ù‡Ø²ÛŒÙ†Ù‡</div>
                <div style="font-weight:600;margin-bottom:10px;" id="anExpense">0</div>
                <div style="color:var(--text2);margin-bottom:4px;">Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø²</div>
                <div style="font-weight:600;color:var(--green);" id="anSavings">0</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px;">
          <div class="card-title">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</div>
          <div id="horizontalBars" style="display:flex;flex-direction:column;gap:10px;"></div>
        </div>
      </div>

      <!-- ========== BUDGETS ========== -->
      <div class="page" id="page-budgets">
        <div class="header">
          <div>
            <h1>Ø¨ÙˆØ¯Ø¬Ù‡â€ŒØ¨Ù†Ø¯ÛŒ</h1>
            <div class="header-date">Ù…Ø¯ÛŒØ±ÛŒØª Ø¨ÙˆØ¯Ø¬Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
          </div>
        </div>
        <div id="budgetCards" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;"></div>
      </div>

      <!-- ========== CATEGORIES ========== -->
      <div class="page" id="page-categories">
        <div class="header">
          <div>
            <h1>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h1>
            <div class="header-date">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ</div>
          </div>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="openCategoryModal()">â• Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯</button>
          </div>
        </div>

        <div class="card" style="margin-bottom:12px;">
          <div class="card-title">ğŸ’µ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯</div>
          <div class="category-grid" id="incomeCategoriesGrid"></div>
        </div>

        <div class="card">
          <div class="card-title">ğŸ”» Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‡Ø²ÛŒÙ†Ù‡</div>
          <div class="category-grid" id="expenseCategoriesGrid"></div>
        </div>
      </div>

      <!-- ========== SETTINGS ========== -->
      <div class="page" id="page-settings">
        <div class="header">
          <div>
            <h1>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h1>
            <div class="header-date">Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡</div>
          </div>
        </div>
        <div class="card" style="max-width:420px;">
          <div style="display:flex;flex-direction:column;gap:16px;">
            <div style="display:flex;justify-content:space-between;align-items:center;font-size:13px;">
              <span>ğŸŒ“ ØªÙ… Ø¨Ø±Ù†Ø§Ù…Ù‡</span>
              <button class="btn btn-outline btn-sm" id="themeToggle2" onclick="toggleTheme()">ØªØºÛŒÛŒØ± ØªÙ…</button>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;font-size:13px;">
              <span>ğŸ’± ÙˆØ§Ø­Ø¯ Ù¾ÙˆÙ„</span>
              <span style="color:var(--accent);font-weight:600;font-size:12px;">ØªÙˆÙ…Ø§Ù†</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;font-size:13px;">
              <span>ğŸŒ Ø²Ø¨Ø§Ù†</span>
              <span style="color:var(--accent);font-weight:600;font-size:12px;">ÙØ§Ø±Ø³ÛŒ</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;font-size:13px;">
              <span>ğŸ“¦ ØªØ¹Ø¯Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´</span>
              <span style="color:var(--accent);font-weight:600;font-size:12px;" id="txCount">0</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;font-size:13px;">
              <span>ğŸ·ï¸ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</span>
              <span style="color:var(--accent);font-weight:600;font-size:12px;" id="catCount">0</span>
            </div>
            <div style="border-top:1px solid var(--border);padding-top:16px;">
              <button class="btn btn-outline" onclick="exportData()" style="width:100%;justify-content:center;margin-bottom:8px;">ğŸ“¤ Ø®Ø±ÙˆØ¬ÛŒ JSON</button>
              <button class="btn btn-outline" onclick="importData()" style="width:100%;justify-content:center;margin-bottom:8px;">ğŸ“¥ ÙˆØ±ÙˆØ¯ÛŒ JSON</button>
              <button class="btn btn-red" onclick="clearAllData()" style="width:100%;justify-content:center;">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
            </div>
            <div style="text-align:center;color:var(--text3);font-size:10px;padding-top:8px;">
              Ù¾ÙˆÙ„â€ŒÛŒØ§Ø± v1.0 â€” Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸<br>
              Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­Ù„ÛŒ ÙØ¹Ø§Ù„ Ø§Ø³Øª âœ…
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>
</div>

<!-- ========== TRANSACTION MODAL ========== -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h2>ğŸ’µ Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯</h2>
    <div class="form-group">
      <div class="type-toggle">
        <button class="type-btn income-type active" id="typeIncome" onclick="setType('income')">â• Ø¯Ø±Ø¢Ù…Ø¯</button>
        <button class="type-btn expense-type" id="typeExpense" onclick="setType('expense')">â– Ù‡Ø²ÛŒÙ†Ù‡</button>
      </div>
    </div>
    <div class="form-group">
      <label>Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)</label>
      <input type="number" id="inputAmount" placeholder="Ù…Ø«Ù„Ø§ ÛµÛ°Û°Ù¬Û°Û°Û°" min="0">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Ø¹Ù†ÙˆØ§Ù†</label>
        <input type="text" id="inputTitle" placeholder="Ù…Ø«Ù„Ø§ Ø­Ù‚ÙˆÙ‚">
      </div>
      <div class="form-group">
        <label>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
        <select id="inputCategory"></select>
      </div>
    </div>
    <div class="form-group">
      <label>ØªØ§Ø±ÛŒØ®</label>
      <input type="date" id="inputDate">
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal()">Ø§Ù†ØµØ±Ø§Ù</button>
      <button class="btn btn-primary" onclick="saveTransaction()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
    </div>
  </div>
</div>

<!-- ========== CATEGORY MODAL ========== -->
<div class="modal-overlay" id="categoryModal">
  <div class="modal">
    <h2>ğŸ·ï¸ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯</h2>
    <div class="form-group">
      <label>Ù†ÙˆØ¹ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
      <div class="type-toggle">
        <button class="type-btn income-type active" id="catTypeIncome" onclick="setCatType('income')">â• Ø¯Ø±Ø¢Ù…Ø¯</button>
        <button class="type-btn expense-type" id="catTypeExpense" onclick="setCatType('expense')">â– Ù‡Ø²ÛŒÙ†Ù‡</button>
      </div>
    </div>
    <div class="form-group">
      <label>Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
      <input type="text" id="catName" placeholder="Ù…Ø«Ù„Ø§ ÙØ±ÙˆØ´ Ù…Ø­ØµÙˆÙ„">
    </div>
    <div class="form-group">
      <label>Ø§Ù†ØªØ®Ø§Ø¨ Ø¢ÛŒÚ©ÙˆÙ†</label>
      <div class="emoji-picker" id="emojiPicker"></div>
    </div>
    <div class="form-group">
      <label>Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù†Ú¯</label>
      <div class="color-picker" id="colorPicker"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeCategoryModal()">Ø§Ù†ØµØ±Ø§Ù</button>
      <button class="btn btn-primary" onclick="saveCategory()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
    </div>
  </div>
</div>

<div class="notification" id="notification"></div>
<input type="file" id="fileInput" accept=".json" style="display:none;">

<script>
  // ============ DATA STORAGE ============
  const STORAGE_KEYS = {
    transactions: 'poolyar_transactions',
    categories: 'poolyar_categories',
    theme: 'poolyar_theme'
  };

  // ============ DATA ============
  let transactions = [];
  let categories = {};
  let currentType = 'income';
  let txFilter = 'all';
  let barView = 'monthly';
  let catType = 'income';
  let selectedEmoji = 'ğŸ“¦';
  let selectedColor = '#6c5ce7';

  const defaultCategories = {
    salary:    { icon:'ğŸ’¼', label:'Ø­Ù‚ÙˆÙ‚',      color:'#6c5ce7', type:'income', isDefault:true },
    freelance: { icon:'ğŸ’»', label:'ÙØ±ÛŒÙ„Ù†Ø³Ø±ÛŒ',   color:'#a29bfe', type:'income', isDefault:true },
    gift:      { icon:'ğŸ', label:'Ù‡Ø¯ÛŒÙ‡',       color:'#fd79a8', type:'income', isDefault:true },
    food:      { icon:'ğŸ•', label:'Ø®ÙˆØ±Ø§Ú©',      color:'#e55039', type:'expense', isDefault:true },
    transport: { icon:'ğŸš—', label:'Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„',    color:'#f9ca24', type:'expense', isDefault:true },
    shopping:  { icon:'ğŸ›ï¸', label:'Ø®Ø±ÛŒØ¯',       color:'#e056a0', type:'expense', isDefault:true },
    bills:     { icon:'ğŸ“±', label:'Ù‚Ø¨ÙˆØ¶',       color:'#00b894', type:'expense', isDefault:true },
    health:    { icon:'ğŸ’Š', label:'Ø³Ù„Ø§Ù…Øª',      color:'#55efc4', type:'expense', isDefault:true },
    fun:       { icon:'ğŸ®', label:'ØªÙØ±ÛŒØ­',      color:'#e17055', type:'expense', isDefault:true },
    education: { icon:'ğŸ“š', label:'Ø¢Ù…ÙˆØ²Ø´',      color:'#0984e3', type:'expense', isDefault:true },
    rent:      { icon:'ğŸ ', label:'Ø§Ø¬Ø§Ø±Ù‡',      color:'#636e72', type:'expense', isDefault:true },
    other:     { icon:'ğŸ“¦', label:'Ø³Ø§ÛŒØ±',       color:'#95a5a6', type:'both', isDefault:true }
  };

  const emojis = ['ğŸ’°','ğŸ’µ','ğŸ’´','ğŸ’¶','ğŸ’·','ğŸ’¸','ğŸ¤‘','ğŸ’³','ğŸ¦','ğŸ“Š','ğŸ“ˆ','ğŸ“‰','ğŸ’¼','ğŸ¢','ğŸ­','ğŸª','ğŸ¬','ğŸ›’','ğŸ›ï¸','ğŸ','ğŸ‰','ğŸŠ','ğŸˆ','ğŸ€','ğŸ’','ğŸ•','ğŸ”','ğŸŸ','ğŸ—','ğŸ–','ğŸŒ­','ğŸ¿','ğŸ§€','ğŸ¥š','ğŸ³','ğŸ§ˆ','ğŸ¥','ğŸ§‡','ğŸ¥“','ğŸ¥©','ğŸ—','ğŸ¥—','ğŸ','ğŸœ','ğŸ²','ğŸ›','ğŸ£','ğŸ±','ğŸ¥Ÿ','ğŸ¤','ğŸ™','ğŸš','ğŸ˜','ğŸ¥','ğŸ¥ ','ğŸ¥®','ğŸ¢','ğŸ¡','ğŸ§','ğŸ¨','ğŸ¦','ğŸ¥§','ğŸ§','ğŸ°','ğŸ‚','ğŸ®','ğŸ­','ğŸ¬','ğŸ«','ğŸ¿','ğŸ©','ğŸª','ğŸŒ°','ğŸ¥œ','ğŸ¯','â˜•','ğŸµ','ğŸ§ƒ','ğŸ¥¤','ğŸ§‹','ğŸ¶','ğŸº','ğŸ»','ğŸ¥‚','ğŸ·','ğŸ¥ƒ','ğŸ¸','ğŸ¹','ğŸ§‰','ğŸ¾','ğŸ§Š','ğŸ¥„','ğŸ´','ğŸ½ï¸','ğŸ¥£','ğŸ¥¡','ğŸ¥¢','ğŸ§‚','ğŸš—','ğŸš•','ğŸš™','ğŸšŒ','ğŸš','ğŸï¸','ğŸš“','ğŸš‘','ğŸš’','ğŸš','ğŸ›»','ğŸšš','ğŸš›','ğŸšœ','ğŸ¦¯','ğŸ¦½','ğŸ¦¼','ğŸ›´','ğŸš²','ğŸ›µ','ğŸï¸','ğŸ›º','âœˆï¸','ğŸš','ğŸš‚','ğŸš†','ğŸš‡','ğŸšŠ','ğŸš','ğŸš„','ğŸš…','ğŸšˆ','ğŸš','ğŸš‹','ğŸšƒ','ğŸšŸ','ğŸš ','ğŸš¡','ğŸ›¶','â›µ','ğŸš¤','ğŸ›¥ï¸','ğŸ›³ï¸','â›´ï¸','ğŸš¢','âš“','ğŸª','â›½','ğŸš§','ğŸš¥','ğŸš¦','ğŸ›‘','ğŸ ','ğŸ¡','ğŸ¢','ğŸ¬','ğŸ£','ğŸ¤','ğŸ¥','ğŸ¦','ğŸ¨','ğŸª','ğŸ«','ğŸ©','ğŸ’’','ğŸ›ï¸','â›ª','ğŸ•Œ','ğŸ›•','ğŸ•','â›©ï¸','ğŸ•‹','ğŸ•ï¸','ğŸï¸','ğŸŸï¸','ğŸ—ï¸','ğŸ˜ï¸','ğŸŒ†','ğŸŒ‡','ğŸŒƒ','ğŸŒ‰','ğŸŒ','ğŸ¡','ğŸ¢','ğŸ ','â›²','â›±ï¸','ğŸ–ï¸','ğŸï¸','ğŸ”ï¸','â›°ï¸','ğŸ—»','ğŸ›ï¸','ğŸ“±','ğŸ’»','âŒ¨ï¸','ğŸ–¥ï¸','ğŸ–¨ï¸','ğŸ–±ï¸','ğŸ–²ï¸','ğŸ•¹ï¸','ğŸ—œï¸','ğŸ’¾','ğŸ’¿','ğŸ“€','ğŸ“¼','ğŸ“·','ğŸ“¸','ğŸ“¹','ğŸ¥','ğŸ“½ï¸','ğŸï¸','ğŸ“','â˜ï¸','ğŸ“Ÿ','ğŸ“ ','ğŸ“º','ğŸ“»','ğŸ™ï¸','ğŸšï¸','ğŸ›ï¸','ğŸ§­','â±ï¸','â²ï¸','â°','ğŸ•°ï¸','âŒ›','â³','ğŸ“¡','ğŸ”‹','ğŸ”Œ','ğŸ’¡','ğŸ”¦','ğŸ•¯ï¸','ğŸª”','ğŸ§¯','ğŸ›¢ï¸','ğŸ’¸','ğŸ’µ','ğŸ’´','ğŸ’¶','ğŸ’·','ğŸª™','ğŸ’°','ğŸ’³','ğŸ§¾','ğŸ’','âš–ï¸','ğŸªœ','ğŸ§°','ğŸª›','ğŸ”§','ğŸ”¨','âš’ï¸','ğŸ› ï¸','â›ï¸','ğŸªš','ğŸ”©','âš™ï¸','ğŸª¤','ğŸ§±','â›“ï¸','ğŸ§²','ğŸ”«','ğŸ’£','ğŸ§¨','ğŸª“','ğŸ”ª','ğŸ—¡ï¸','âš”ï¸','ğŸ›¡ï¸','ğŸš¬','âš°ï¸','ğŸª¦','âš±ï¸','ğŸº','ğŸ”®','ğŸ“¿','ğŸ§¿','ğŸ’ˆ','âš—ï¸','ğŸ”­','ğŸ”¬','ğŸ•³ï¸','ğŸ©¹','ğŸ©º','ğŸ’Š','ğŸ’‰','ğŸ©¸','ğŸ¦ ','ğŸ§¬','ğŸ§ª','ğŸŒ¡ï¸','ğŸ§¹','ğŸª ','ğŸ§º','ğŸ§»','ğŸª£','ğŸ§¼','ğŸª¥','ğŸ§½','ğŸ§´','ğŸ›ï¸','ğŸ”‘','ğŸ—ï¸','ğŸšª','ğŸª‘','ğŸ›‹ï¸','ğŸ›ï¸','ğŸ›Œ','ğŸ§¸','ğŸª†','ğŸ–¼ï¸','ğŸª','ğŸªŸ','ğŸ›ï¸','ğŸ','ğŸˆ','ğŸ','ğŸ€','ğŸª„','ğŸª…','ğŸŠ','ğŸ‰','ğŸ','ğŸ®','ğŸ','ğŸ§§','âœ‰ï¸','ğŸ“©','ğŸ“¨','ğŸ“§','ğŸ’Œ','ğŸ“¥','ğŸ“¤','ğŸ“¦','ğŸ·ï¸','ğŸª§','ğŸ“ª','ğŸ“«','ğŸ“¬','ğŸ“­','ğŸ“®','ğŸ“¯','ğŸ“œ','ğŸ“ƒ','ğŸ“„','ğŸ“‘','ğŸ§¾','ğŸ“Š','ğŸ“ˆ','ğŸ“‰','ğŸ—’ï¸','ğŸ—“ï¸','ğŸ“†','ğŸ“…','ğŸ—‘ï¸','ğŸ“‡','ğŸ—ƒï¸','ğŸ—³ï¸','ğŸ—„ï¸','ğŸ“‹','ğŸ“','ğŸ“‚','ğŸ—‚ï¸','ğŸ—ï¸','ğŸ“°','ğŸ““','ğŸ“”','ğŸ“’','ğŸ“•','ğŸ“—','ğŸ“˜','ğŸ“™','ğŸ“š','ğŸ“–','ğŸ”–','ğŸ§·','ğŸ”—','ğŸ“','ğŸ–‡ï¸','ğŸ“','ğŸ“','ğŸ§®','ğŸ“Œ','ğŸ“','âœ‚ï¸','ğŸ–Šï¸','ğŸ–‹ï¸','âœ’ï¸','ğŸ–Œï¸','ğŸ–ï¸','ğŸ“','âœï¸','ğŸ”','ğŸ”','ğŸ”','ğŸ”','ğŸ”’','ğŸ”“','â¤ï¸','ğŸ§¡','ğŸ’›','ğŸ’š','ğŸ’™','ğŸ’œ','ğŸ–¤','ğŸ¤','ğŸ¤','ğŸ’”','â¤ï¸â€ğŸ”¥','â¤ï¸â€ğŸ©¹','ğŸ’•','ğŸ’','ğŸ’“','ğŸ’—','ğŸ’–','ğŸ’˜','ğŸ’','â£ï¸','â­','ğŸŒŸ','âœ¨','âš¡','ğŸ”¥','ğŸ’«','â˜€ï¸','ğŸŒ™','â­'];

  const colors = ['#6c5ce7','#a29bfe','#fd79a8','#e55039','#f9ca24','#e056a0','#00b894','#55efc4','#e17055','#0984e3','#74b9ff','#636e72','#b2bec3','#2d3436','#ff7675','#fab1a0','#ffeaa7','#dfe6e9','#00cec9','#81ecec','#a29bfe','#6c5ce7','#fdcb6e','#e17055','#d63031','#ff6b6b','#ee5a6f','#c44569','#f368e0','#ff9ff3','#54a0ff','#48dbfb','#0abde3','#00d2d3','#1dd1a1','#10ac84','#576574','#222f3e','#f8b500','#ff6348'];

  const gMonths = ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†','Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª','Ø®Ø±Ø¯Ø§Ø¯','ØªÛŒØ±','Ù…Ø±Ø¯Ø§Ø¯','Ø´Ù‡Ø±ÛŒÙˆØ±','Ù…Ù‡Ø±','Ø¢Ø¨Ø§Ù†','Ø¢Ø°Ø±','Ø¯ÛŒ','Ø¨Ù‡Ù…Ù†','Ø§Ø³ÙÙ†Ø¯'];

  // ============ LOAD/SAVE ============
  function loadData() {
    try {
      const savedTx = localStorage.getItem(STORAGE_KEYS.transactions);
      const savedCat = localStorage.getItem(STORAGE_KEYS.categories);
      const savedTheme = localStorage.getItem(STORAGE_KEYS.theme);
      
      transactions = savedTx ? JSON.parse(savedTx) : [];
      categories = savedCat ? JSON.parse(savedCat) : { ...defaultCategories };
      
      if (savedTheme === 'dark') {
        isDark = true;
        document.documentElement.setAttribute('data-theme', 'dark');
        document.getElementById('themeToggle').textContent = 'â˜€ï¸';
      }
      
      // Ø§Ú¯Ø± Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯ØŒ Ø§Ø² Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
      if (Object.keys(categories).length === 0) {
        categories = { ...defaultCategories };
      }
    } catch (e) {
      console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:', e);
      categories = { ...defaultCategories };
    }
  }

  function saveData() {
    try {
      localStorage.setItem(STORAGE_KEYS.transactions, JSON.stringify(transactions));
      localStorage.setItem(STORAGE_KEYS.categories, JSON.stringify(categories));
      localStorage.setItem(STORAGE_KEYS.theme, isDark ? 'dark' : 'light');
    } catch (e) {
      console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ:', e);
      notify('âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§');
    }
  }

  // ============ THEME ============
  let isDark = false;

  function toggleTheme() {
    isDark = !isDark;
    document.documentElement.setAttribute('data-theme', isDark ? 'dark' : '');
    document.getElementById('themeToggle').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
    saveData();
  }

  document.getElementById('themeToggle').addEventListener('click', toggleTheme);

  // ============ HELPERS ============
  function daysAgo(n) {
    const d = new Date(); 
    d.setDate(d.getDate() - n);
    return d.toISOString().split('T')[0];
  }

  function genId() { 
    return Date.now().toString(36) + Math.random().toString(36).substr(2, 9); 
  }

  function fmt(n) { 
    return Number(n).toLocaleString('fa-IR'); 
  }

  function fmtDate(ds) {
    const d = new Date(ds);
    const months = ['Ú˜Ø§Ù†ÙˆÛŒÙ‡','ÙÙˆØ±ÛŒÙ‡','Ù…Ø§Ø±Ø³','Ø¢ÙˆØ±ÛŒÙ„','Ù…Ù‡','Ú˜ÙˆØ¦Ù†','Ú˜ÙˆØ¦ÛŒÙ‡','Ø§ÙˆØª','Ø³Ù¾ØªØ§Ù…Ø¨Ø±','Ø§Ú©ØªØ¨Ø±','Ù†ÙˆØ§Ù…Ø¨Ø±','Ø¯Ø³Ø§Ù…Ø¨Ø±'];
    return `${d.getDate()} ${months[d.getMonth()]}`;
  }

  function getMonth(offset = 0) {
    const now = new Date();
    const target = new Date(now.getFullYear(), now.getMonth() + offset, 1);
    return transactions.filter(t => {
      const d = new Date(t.date);
      return d.getMonth() === target.getMonth() && d.getFullYear() === target.getFullYear();
    });
  }

  function sumType(arr, type) { 
    return arr.filter(t => t.type === type).reduce((s, t) => s + t.amount, 0); 
  }

  function getCategoryList(type) {
    return Object.entries(categories)
      .filter(([_, cat]) => cat.type === type || cat.type === 'both')
      .map(([key, cat]) => ({ key, ...cat }));
  }

  // ============ SEED ============
  function seedData() {
    if (transactions.length > 0) return; // Ø§Ú¯Ø± Ø¯Ø§Ø¯Ù‡ Ø¯Ø§Ø±Ù‡ seed Ù†Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    
    const items = [
      { type:'income', amount:15000000, title:'Ø­Ù‚ÙˆÙ‚ Ù…Ø§Ù‡Ø§Ù†Ù‡', category:'salary', date:daysAgo(1) },
      { type:'income', amount:4200000, title:'Ù¾Ø±ÙˆÚ˜Ù‡ ÙØ±ÛŒÙ„Ù†Ø³Ø±ÛŒ', category:'freelance', date:daysAgo(3) },
      { type:'income', amount:1000000, title:'Ù‡Ø¯ÛŒÙ‡ ØªÙˆÙ„Ø¯', category:'gift', date:daysAgo(5) },
      { type:'expense', amount:920000, title:'Ø®Ø±ÛŒØ¯ Ù‡ÙØªÚ¯ÛŒ', category:'food', date:daysAgo(0) },
      { type:'expense', amount:250000, title:'Ø¨Ù†Ø²ÛŒÙ†', category:'transport', date:daysAgo(1) },
      { type:'expense', amount:1800000, title:'Ù„Ø¨Ø§Ø³ Ø²Ù…Ø³ØªØ§Ù†ÛŒ', category:'shopping', date:daysAgo(2) },
      { type:'expense', amount:520000, title:'Ù‚Ø¨Ø¶ Ø¨Ø±Ù‚ Ùˆ Ú¯Ø§Ø²', category:'bills', date:daysAgo(4) },
      { type:'expense', amount:380000, title:'Ø¯Ø§Ø±Ùˆ', category:'health', date:daysAgo(5) },
      { type:'expense', amount:650000, title:'Ø³ÛŒÙ†Ù…Ø§ Ùˆ Ø±Ø³ØªÙˆØ±Ø§Ù†', category:'fun', date:daysAgo(2) },
      { type:'income', amount:2500000, title:'Ù¾Ø§Ø¯Ø§Ø´', category:'salary', date:daysAgo(7) },
      { type:'expense', amount:1100000, title:'Ø¯ÙˆØ±Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ†', category:'education', date:daysAgo(6) },
      { type:'expense', amount:350000, title:'ØªØ§Ú©Ø³ÛŒ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ', category:'transport', date:daysAgo(3) },
      { type:'expense', amount:480000, title:'Ø±Ø³ØªÙˆØ±Ø§Ù†', category:'food', date:daysAgo(8) },
      { type:'income', amount:6000000, title:'ÙØ±ÙˆØ´ Ù…Ø­ØµÙˆÙ„', category:'freelance', date:daysAgo(10) },
      { type:'expense', amount:750000, title:'Ø®Ø±ÛŒØ¯ Ø¢Ù†Ù„Ø§ÛŒÙ†', category:'shopping', date:daysAgo(9) },
      { type:'expense', amount:280000, title:'Ù‚Ø¨Ø¶ Ù…ÙˆØ¨Ø§ÛŒÙ„', category:'bills', date:daysAgo(11) },
      { type:'expense', amount:5000000, title:'Ø§Ø¬Ø§Ø±Ù‡ Ø®Ø§Ù†Ù‡', category:'rent', date:daysAgo(1) },
      { type:'income', amount:13000000, title:'Ø­Ù‚ÙˆÙ‚ Ù…Ø§Ù‡ Ù‚Ø¨Ù„', category:'salary', date:daysAgo(32) },
      { type:'expense', amount:4800000, title:'Ø§Ø¬Ø§Ø±Ù‡ Ù…Ø§Ù‡ Ù‚Ø¨Ù„', category:'rent', date:daysAgo(30) },
      { type:'expense', amount:900000, title:'Ø®ÙˆØ±Ø§Ú©', category:'food', date:daysAgo(20) },
    ];
    items.forEach(i => transactions.push({ ...i, id: genId() }));
    saveData();
  }

  // ============ NAVIGATION ============
  function switchPage(page, btn) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
    document.getElementById('page-' + page).classList.add('active');
    if (btn) btn.classList.add('active');
    renderAll();
  }

  // ============ TRANSACTION MODAL ============
  function updateCategoryOptions() {
    const sel = document.getElementById('inputCategory');
    const cats = getCategoryList(currentType);
    sel.innerHTML = cats.map(c =>
      `<option value="${c.key}">${c.icon} ${c.label}</option>`
    ).join('');
  }

  function openModal(type) {
    currentType = type;
    updateTypeButtons();
    updateCategoryOptions();
    document.getElementById('inputDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('inputAmount').value = '';
    document.getElementById('inputTitle').value = '';
    document.getElementById('modalOverlay').classList.add('active');
    setTimeout(() => document.getElementById('inputAmount').focus(), 200);
  }

  function closeModal() { 
    document.getElementById('modalOverlay').classList.remove('active'); 
  }

  document.getElementById('modalOverlay').addEventListener('click', e => {
    if (e.target === e.currentTarget) closeModal();
  });

  function setType(type) {
    currentType = type;
    updateTypeButtons();
    updateCategoryOptions();
  }

  function updateTypeButtons() {
    document.getElementById('typeIncome').classList.toggle('active', currentType === 'income');
    document.getElementById('typeExpense').classList.toggle('active', currentType === 'expense');
  }

  function saveTransaction() {
    const amount = parseInt(document.getElementById('inputAmount').value);
    const title = document.getElementById('inputTitle').value.trim();
    const category = document.getElementById('inputCategory').value;
    const date = document.getElementById('inputDate').value;

    if (!amount || amount <= 0) { notify('âŒ Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ù„Øº Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return; }
    if (!title) { notify('âŒ Ù„Ø·ÙØ§Ù‹ Ø¹Ù†ÙˆØ§Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return; }
    if (!date) { notify('âŒ Ù„Ø·ÙØ§Ù‹ ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯'); return; }

    transactions.push({ id: genId(), type: currentType, amount, title, category, date });
    closeModal();
    saveData();
    renderAll();
    notify(currentType === 'income' ? 'âœ… Ø¯Ø±Ø¢Ù…Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯' : 'âœ… Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯');
  }

  function deleteTransaction(id) {
    if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
    transactions = transactions.filter(t => t.id !== id);
    saveData();
    renderAll();
    notify('ğŸ—‘ï¸ ØªØ±Ø§Ú©Ù†Ø´ Ø­Ø°Ù Ø´Ø¯');
  }

  function notify(msg) {
    const el = document.getElementById('notification');
    el.textContent = msg;
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 2500);
  }

  // ============ CATEGORY MODAL ============
  function renderEmojiPicker() {
    const container = document.getElementById('emojiPicker');
    container.innerHTML = emojis.map(e => 
      `<button class="emoji-item" onclick="selectEmoji('${e}')">${e}</button>`
    ).join('');
  }

  function renderColorPicker() {
    const container = document.getElementById('colorPicker');
    container.innerHTML = colors.map(c => 
      `<button class="color-item ${c === selectedColor ? 'active' : ''}" 
        style="background:${c}" onclick="selectColor('${c}')"></button>`
    ).join('');
  }

  function selectEmoji(emoji) {
    selectedEmoji = emoji;
    document.querySelectorAll('.emoji-item').forEach(e => {
      e.style.background = e.textContent === emoji ? 'var(--accent-glass)' : '';
    });
  }

  function selectColor(color) {
    selectedColor = color;
    document.querySelectorAll('.color-item').forEach(e => {
      e.classList.toggle('active', e.style.background === color);
    });
  }

  function setCatType(type) {
    catType = type;
    document.getElementById('catTypeIncome').classList.toggle('active', type === 'income');
    document.getElementById('catTypeExpense').classList.toggle('active', type === 'expense');
  }

  function openCategoryModal() {
    catType = 'income';
    selectedEmoji = 'ğŸ“¦';
    selectedColor = '#6c5ce7';
    document.getElementById('catName').value = '';
    setCatType('income');
    renderEmojiPicker();
    renderColorPicker();
    document.getElementById('categoryModal').classList.add('active');
    setTimeout(() => document.getElementById('catName').focus(), 200);
  }

  function closeCategoryModal() {
    document.getElementById('categoryModal').classList.remove('active');
  }

  document.getElementById('categoryModal').addEventListener('click', e => {
    if (e.target === e.currentTarget) closeCategoryModal();
  });

  function saveCategory() {
    const name = document.getElementById('catName').value.trim();
    if (!name) { notify('âŒ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return; }

    const key = 'custom_' + genId();
    categories[key] = {
      icon: selectedEmoji,
      label: name,
      color: selectedColor,
      type: catType,
      isDefault: false
    };

    closeCategoryModal();
    saveData();
    renderAll();
    notify('âœ… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯');
  }

  function deleteCategory(key) {
    if (categories[key].isDefault) {
      notify('âš ï¸ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù‚Ø§Ø¨Ù„ Ø­Ø°Ù Ù†ÛŒØ³ØªÙ†Ø¯');
      return;
    }
    
    const usedInTx = transactions.some(t => t.category === key);
    if (usedInTx) {
      notify('âš ï¸ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª');
      return;
    }

    if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
    
    delete categories[key];
    saveData();
    renderAll();
    notify('ğŸ—‘ï¸ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ø°Ù Ø´Ø¯');
  }

  function renderCategories() {
    const incomeCats = getCategoryList('income');
    const expenseCats = getCategoryList('expense').filter(c => c.type === 'expense');

    document.getElementById('incomeCategoriesGrid').innerHTML = incomeCats.length
      ? incomeCats.map(c => `
        <div class="category-card">
          <div class="category-card-header">
            <div class="category-card-icon" style="background:${c.color}20">${c.icon}</div>
            ${!c.isDefault ? `<button class="category-delete" onclick="deleteCategory('${c.key}')">ğŸ—‘ï¸</button>` : ''}
          </div>
          <div class="category-card-name">${c.label}</div>
          <div class="category-card-type">Ø¯Ø±Ø¢Ù…Ø¯</div>
        </div>
      `).join('')
      : '<div class="empty-state">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>';

    document.getElementById('expenseCategoriesGrid').innerHTML = expenseCats.length
      ? expenseCats.map(c => `
        <div class="category-card">
          <div class="category-card-header">
            <div class="category-card-icon" style="background:${c.color}20">${c.icon}</div>
            ${!c.isDefault ? `<button class="category-delete" onclick="deleteCategory('${c.key}')">ğŸ—‘ï¸</button>` : ''}
          </div>
          <div class="category-card-name">${c.label}</div>
          <div class="category-card-type">Ù‡Ø²ÛŒÙ†Ù‡</div>
        </div>
      `).join('')
      : '<div class="empty-state">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‡Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>';
  }

  // ============ RENDER STATS ============
  function renderStats() {
    const thisM = getMonth(0);
    const lastM = getMonth(-1);
    const inc = sumType(thisM, 'income');
    const exp = sumType(thisM, 'expense');
    const bal = inc - exp;
    const pInc = sumType(lastM, 'income');
    const pExp = sumType(lastM, 'expense');
    const incCh = pInc ? Math.round(((inc - pInc) / pInc) * 100) : 0;
    const expCh = pExp ? Math.round(((exp - pExp) / pExp) * 100) : 0;
    const totalBal = sumType(transactions, 'income') - sumType(transactions, 'expense');

    document.getElementById('statsCards').innerHTML = `
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon income">ğŸ’µ</div>
          <span class="stat-change ${incCh >= 0 ? 'up' : 'down'}">${incCh >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(incCh)}%</span>
        </div>
        <div class="stat-label">Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
        <div class="stat-value" style="color:var(--green);">${fmt(inc)}</div>
        ${miniChartHTML(thisM, 'income')}
      </div>
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon expense">ğŸ”»</div>
          <span class="stat-change ${expCh <= 0 ? 'up' : 'down'}">${expCh > 0 ? 'â–²' : 'â–¼'} ${Math.abs(expCh)}%</span>
        </div>
        <div class="stat-label">Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
        <div class="stat-value" style="color:var(--red);">${fmt(exp)}</div>
        ${miniChartHTML(thisM, 'expense')}
      </div>
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon balance">ğŸ’</div>
        </div>
        <div class="stat-label">ØªØ±Ø§Ø² Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
        <div class="stat-value" style="color:${bal >= 0 ? 'var(--green)' : 'var(--red)'};">${fmt(bal)}</div>
        <div style="font-size:10px;color:var(--text3);margin-top:6px;">Ø§ÛŒÙ† Ù…Ø§Ù‡</div>
      </div>
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon savings">ğŸ¦</div>
        </div>
        <div class="stat-label">Ú©Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</div>
        <div class="stat-value" style="color:${totalBal >= 0 ? 'var(--accent)' : 'var(--red)'};">${fmt(totalBal)}</div>
        <div style="font-size:10px;color:var(--text3);margin-top:6px;">Ø§Ø² ${fmt(transactions.length)} ØªØ±Ø§Ú©Ù†Ø´</div>
      </div>
    `;
  }

  function miniChartHTML(data, type) {
    const days = {};
    data.filter(t => t.type === type).forEach(t => {
      const d = new Date(t.date).getDate();
      days[d] = (days[d] || 0) + t.amount;
    });
    const vals = Object.values(days);
    if (!vals.length) return '<div class="mini-chart"></div>';
    const max = Math.max(...vals);
    const color = type === 'income' ? 'var(--green)' : 'var(--red)';
    return '<div class="mini-chart">' + vals.slice(-8).map(v =>
      `<div class="mini-bar" style="height:${Math.max(3,(v/max)*100)}%;background:${color};"></div>`
    ).join('') + '</div>';
  }

  // ============ BAR CHART ============
  function setBarView(v, btn) {
    barView = v;
    document.querySelectorAll('.chart-tab').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderBarChart();
  }

  function renderBarChart() {
    const ct = document.getElementById('barChart');
    let groups = [];

    if (barView === 'monthly') {
      for (let i = 5; i >= 0; i--) {
        const d = new Date(); 
        d.setMonth(d.getMonth() - i);
        const m = d.getMonth(), y = d.getFullYear();
        const mTx = transactions.filter(t => { 
          const td = new Date(t.date); 
          return td.getMonth() === m && td.getFullYear() === y; 
        });
        groups.push({ 
          label: gMonths[m].substring(0, 3), 
          income: sumType(mTx, 'income'), 
          expense: sumType(mTx, 'expense') 
        });
      }
    } else {
      for (let i = 3; i >= 0; i--) {
        const start = new Date(); 
        start.setDate(start.getDate() - (i + 1) * 7);
        const end = new Date(); 
        end.setDate(end.getDate() - i * 7);
        const wTx = transactions.filter(t => { 
          const d = new Date(t.date); 
          return d >= start && d < end; 
        });
        groups.push({ 
          label: `Ù‡ÙØªÙ‡ ${4-i}`, 
          income: sumType(wTx, 'income'), 
          expense: sumType(wTx, 'expense') 
        });
      }
    }

    const max = Math.max(...groups.map(g => Math.max(g.income, g.expense)), 1);
    ct.innerHTML = groups.map(g => `
      <div class="bar-group">
        <div class="bar-pair">
          <div class="bar income-bar" style="height:${Math.max(3,(g.income/max)*130)}px;" title="Ø¯Ø±Ø¢Ù…Ø¯: ${fmt(g.income)}"></div>
          <div class="bar expense-bar" style="height:${Math.max(3,(g.expense/max)*130)}px;" title="Ù‡Ø²ÛŒÙ†Ù‡: ${fmt(g.expense)}"></div>
        </div>
        <div class="bar-label">${g.label}</div>
      </div>
    `).join('');
  }

  // ============ DONUT ============
  function renderDonut() {
    const expenses = getMonth(0).filter(t => t.type === 'expense');
    const catTotals = {};
    expenses.forEach(t => { 
      catTotals[t.category] = (catTotals[t.category] || 0) + t.amount; 
    });
    const total = Object.values(catTotals).reduce((s, v) => s + v, 0) || 1;
    const sorted = Object.entries(catTotals).sort((a, b) => b[1] - a[1]);

    const r = 52, circ = 2 * Math.PI * r;
    let offset = 0;

    const circles = sorted.map(([cat, val]) => {
      const dash = (val / total) * circ;
      const catData = categories[cat] || categories.other;
      const c = `<circle cx="65" cy="65" r="${r}" fill="none" stroke="${catData.color}"
        stroke-width="14" stroke-dasharray="${dash} ${circ - dash}" stroke-dashoffset="${-offset}" 
        style="transition:all 0.5s;" />`;
      offset += dash;
      return c;
    });

    const legend = sorted.slice(0, 6).map(([cat, val]) => {
      const catData = categories[cat] || categories.other;
      return `
        <div class="legend-item">
          <div class="legend-right">
            <span class="legend-color" style="background:${catData.color};"></span>
            <span>${catData.icon} ${catData.label}</span>
          </div>
          <span style="color:var(--text2);direction:ltr;font-size:10px;">${Math.round((val/total)*100)}%</span>
        </div>
      `;
    }).join('');

    document.getElementById('donutChart').innerHTML = `
      <div class="donut-center">
        <svg width="130" height="130" viewBox="0 0 130 130" style="transform:rotate(-90deg);">
          ${circles.join('')}
        </svg>
        <div class="donut-total">
          <div class="donut-total-label">Ù…Ø¬Ù…ÙˆØ¹ Ù‡Ø²ÛŒÙ†Ù‡</div>
          <div class="donut-total-value">${fmt(total)}</div>
        </div>
      </div>
      <div class="donut-legend">${legend || '<div class="empty-state">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>'}</div>
    `;
  }

  // ============ TRANSACTIONS LIST ============
  function txHTML(t, showDelete = false) {
    const cat = categories[t.category] || categories.other;
    return `
      <div class="tx-item">
        <div class="tx-right">
          <div class="tx-icon">${cat.icon}</div>
          <div>
            <div class="tx-name">${t.title}</div>
            <div class="tx-cat">${cat.label} Â· ${fmtDate(t.date)}</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <div style="text-align:left;">
            <div class="tx-amount ${t.type}">${t.type === 'income' ? '+' : '-'}${fmt(t.amount)}</div>
          </div>
          ${showDelete ? `<button class="tx-delete" onclick="deleteTransaction('${t.id}')" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>` : ''}
        </div>
      </div>
    `;
  }

  function renderRecentTx() {
    const sorted = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
    document.getElementById('recentTx').innerHTML = sorted.length
      ? sorted.slice(0, 7).map(t => txHTML(t)).join('')
      : '<div class="empty-state">Ù‡Ù†ÙˆØ² ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ ğŸ“­</div>';
  }

  function filterTx(f, btn) {
    txFilter = f;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    if (btn) btn.classList.add('active');
    renderAllTx();
  }

  function renderAllTx() {
    let sorted = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
    if (txFilter !== 'all') sorted = sorted.filter(t => t.type === txFilter);
    const q = (document.getElementById('txSearch')?.value || '').trim().toLowerCase();
    if (q) sorted = sorted.filter(t => 
      t.title.toLowerCase().includes(q) || 
      (categories[t.category]?.label || '').toLowerCase().includes(q)
    );
    document.getElementById('allTx').innerHTML = sorted.length
      ? sorted.map(t => txHTML(t, true)).join('')
      : '<div class="empty-state">ØªØ±Ø§Ú©Ù†Ø´ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯ ğŸ¤·</div>';
  }

  // ============ AREA CHART ============
  function renderAreaChart() {
    const svg = document.getElementById('areaChart');
    const sorted = [...transactions].sort((a, b) => new Date(a.date) - new Date(b.date));
    let balance = 0;
    const daily = {};
    sorted.forEach(t => {
      balance += t.type === 'income' ? t.amount : -t.amount;
      daily[t.date] = balance;
    });

    const vals = Object.values(daily);
    if (vals.length < 2) {
      svg.innerHTML = '<text x="50%" y="50%" text-anchor="middle" fill="var(--text3)" font-size="12" font-family="Vazirmatn">Ø¯Ø§Ø¯Ù‡ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª</text>';
      return;
    }

    const min = Math.min(...vals), max = Math.max(...vals), range = max - min || 1;
    const w = 200, h = 80, p = 5;
    const pts = vals.map((v, i) => ({
      x: p + (i / (vals.length - 1)) * (w - p * 2),
      y: h - p - ((v - min) / range) * (h - p * 2)
    }));

    function catmull(pts) {
      if (pts.length < 2) return '';
      let d = `M${pts[0].x},${pts[0].y}`;
      for (let i = 0; i < pts.length - 1; i++) {
        const p0 = pts[Math.max(0, i - 1)];
        const p1 = pts[i];
        const p2 = pts[i + 1];
        const p3 = pts[Math.min(pts.length - 1, i + 2)];
        const cp1x = p1.x + (p2.x - p0.x) / 6;
        const cp1y = p1.y + (p2.y - p0.y) / 6;
        const cp2x = p2.x - (p3.x - p1.x) / 6;
        const cp2y = p2.y - (p3.y - p1.y) / 6;
        d += ` C${cp1x},${cp1y} ${cp2x},${cp2y} ${p2.x},${p2.y}`;
      }
      return d;
    }

    const line = catmull(pts);
    const area = line + ` L${pts[pts.length-1].x},${h} L${pts[0].x},${h} Z`;

    svg.setAttribute('viewBox', `0 0 ${w} ${h}`);
    svg.setAttribute('preserveAspectRatio', 'none');
    svg.innerHTML = `
      <defs>
        <linearGradient id="ag" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="var(--accent)" stop-opacity="0.3"/>
          <stop offset="100%" stop-color="var(--accent)" stop-opacity="0"/>
        </linearGradient>
      </defs>
      <path d="${area}" fill="url(#ag)"/>
      <path d="${line}" fill="none" stroke="var(--accent)" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="${pts[pts.length-1].x}" cy="${pts[pts.length-1].y}" r="2.5" fill="var(--accent2)" stroke="var(--accent)" stroke-width="1"/>
    `;
  }

  // ============ ANALYTICS ============
  function renderAnalytics() {
    // Heatmap
    const last30 = {};
    for (let i = 29; i >= 0; i--) last30[daysAgo(i)] = 0;
    transactions.filter(t => t.type === 'expense').forEach(t => { 
      if (last30[t.date] !== undefined) last30[t.date] += t.amount; 
    });
    const hv = Object.values(last30);
    const hMax = Math.max(...hv) || 1;
    const cells = Object.entries(last30);
    while (cells.length % 7 !== 0) cells.unshift(['', 0]);

    document.getElementById('heatmap').innerHTML = cells.map(([d, v]) => {
      if (!d) return '<div class="heat-cell"></div>';
      const a = v > 0 ? 0.15 + (v / hMax) * 0.85 : 0;
      return `<div class="heat-cell" style="background:rgba(229,80,57,${a});" title="${d}: ${fmt(v)} Øª"></div>`;
    }).join('');

    // Savings ring
    const thisM = getMonth(0);
    const inc = sumType(thisM, 'income'), exp = sumType(thisM, 'expense'), sav = inc - exp;
    const pct = inc > 0 ? Math.max(0, Math.min(100, Math.round((sav / inc) * 100))) : 0;
    const ring = document.getElementById('savingsRing');
    ring.setAttribute('stroke-dashoffset', 283 - (pct / 100) * 283);
    document.getElementById('savingsPercent').textContent = `${pct}%`;
    document.getElementById('anIncome').textContent = fmt(inc) + ' Øª';
    document.getElementById('anExpense').textContent = fmt(exp) + ' Øª';
    document.getElementById('anSavings').textContent = fmt(sav) + ' Øª';

    // Horizontal bars
    const catTotals = {};
    transactions.filter(t => t.type === 'expense').forEach(t => { 
      catTotals[t.category] = (catTotals[t.category] || 0) + t.amount; 
    });
    const sc = Object.entries(catTotals).sort((a, b) => b[1] - a[1]);
    const cMax = sc.length ? sc[0][1] : 1;

    document.getElementById('horizontalBars').innerHTML = sc.length
      ? sc.map(([cat, val]) => {
        const c = categories[cat] || categories.other;
        return `
          <div style="display:flex;align-items:center;gap:10px;">
            <span style="width:70px;font-size:11px;display:flex;align-items:center;gap:5px;flex-shrink:0;">${c.icon} ${c.label}</span>
            <div style="flex:1;height:20px;background:var(--glass2);border-radius:5px;overflow:hidden;">
              <div style="height:100%;width:${Math.round((val/cMax)*100)}%;background:${c.color};border-radius:5px;transition:width 0.5s;"></div>
            </div>
            <span style="font-size:10px;color:var(--text2);width:80px;text-align:left;direction:ltr;">${fmt(val)}</span>
          </div>
        `;
      }).join('')
      : '<div class="empty-state">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>';
  }

  // ============ BUDGETS ============
  function renderBudgets() {
    const budgets = getCategoryList('expense').map(c => ({
      cat: c.key,
      limit: 2000000 // Ø¨ÙˆØ¯Ø¬Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    }));

    const thisExp = getMonth(0).filter(t => t.type === 'expense');

    document.getElementById('budgetCards').innerHTML = budgets.length
      ? budgets.map(b => {
        const c = categories[b.cat];
        const spent = thisExp.filter(t => t.category === b.cat).reduce((s, t) => s + t.amount, 0);
        const pct = Math.min(100, Math.round((spent / b.limit) * 100));
        const over = spent > b.limit;
        const barColor = over ? 'var(--red)' : pct > 75 ? 'var(--yellow)' : 'var(--green)';

        return `
          <div class="card">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
              <div style="display:flex;align-items:center;gap:10px;">
                <div class="tx-icon" style="font-size:20px;">${c.icon}</div>
                <div>
                  <div style="font-size:13px;font-weight:600;">${c.label}</div>
                  <div style="font-size:10px;color:var(--text3);">${fmt(b.limit)} Ø¨ÙˆØ¯Ø¬Ù‡</div>
                </div>
              </div>
              <span style="font-size:18px;font-weight:700;color:${barColor};">${pct}%</span>
            </div>
            <div style="height:6px;background:var(--glass2);border-radius:3px;overflow:hidden;margin-bottom:8px;">
              <div style="height:100%;width:${pct}%;background:${barColor};border-radius:3px;transition:width 0.5s;"></div>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text2);">
              <span>Ù…ØµØ±Ù: ${fmt(spent)}</span>
              <span>${over ? 'âš ï¸ Ø§Ø¶Ø§ÙÙ‡: ' + fmt(spent - b.limit) : 'Ù…Ø§Ù†Ø¯Ù‡: ' + fmt(b.limit - spent)}</span>
            </div>
          </div>
        `;
      }).join('')
      : '<div class="empty-state">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‡Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>';
  }

  // ============ SETTINGS ============
  function renderSettings() {
    const txEl = document.getElementById('txCount');
    const catEl = document.getElementById('catCount');
    if (txEl) txEl.textContent = fmt(transactions.length);
    if (catEl) catEl.textContent = fmt(Object.keys(categories).length);
  }

  // ============ EXPORT/IMPORT ============
  function exportData() {
    const data = {
      transactions,
      categories,
      exportDate: new Date().toISOString(),
      version: '1.0'
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `poolyar-backup-${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
    notify('ğŸ“¤ ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯');
  }

  function importData() {
    document.getElementById('fileInput').click();
  }

  document.getElementById('fileInput').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = ev => {
      try {
        const data = JSON.parse(ev.target.result);
        if (data.transactions && data.categories) {
          transactions = data.transactions;
          categories = data.categories;
          saveData();
          renderAll();
          notify('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯');
        } else {
          notify('âŒ ÙØ±Ù…Øª ÙØ§ÛŒÙ„ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª');
        }
      } catch (err) {
        notify('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„');
      }
    };
    reader.readAsText(file);
    e.target.value = '';
  });

  function clearAllData() {
    if (!confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯ Ùˆ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª!')) return;
    transactions = [];
    categories = { ...defaultCategories };
    saveData();
    renderAll();
    notify('ğŸ—‘ï¸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯');
  }

  // ============ RENDER ALL ============
  function renderAll() {
    renderStats();
    renderBarChart();
    renderDonut();
    renderRecentTx();
    renderAreaChart();
    renderAllTx();
    renderAnalytics();
    renderBudgets();
    renderCategories();
    renderSettings();
  }

  // ============ KEYBOARD ============
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      closeModal();
      closeCategoryModal();
    }
    if (e.ctrlKey && e.key === 'n') { 
      e.preventDefault(); 
      openModal('income'); 
    }
  });

  // ============ INIT ============
  function init() {
    loadData();
    
    const now = new Date();
    document.getElementById('currentDate').textContent = now.toLocaleDateString('fa-IR', {
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric'
    });
    
    document.getElementById('inputDate').value = now.toISOString().split('T')[0];
    updateCategoryOptions();
    
    // Ø§Ú¯Ø± ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ù†Ø¯Ø§Ø±ÛŒÙ…ØŒ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÙˆÙ†Ù‡ Ø¨Ø³Ø§Ø²
    if (transactions.length === 0) {
      seedData();
    }
    
    renderAll();
    notify('âœ… Ù¾ÙˆÙ„â€ŒÛŒØ§Ø± Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!');
  }

  // Start app
  init();
</script>
</body>
</html>